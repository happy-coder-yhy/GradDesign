# Excel文件上传功能使用指南

## 功能说明

A*算法页面的"多航班调度"模块现已支持Excel文件上传功能！你可以上传包含航班信息的Excel文件，系统会自动解析并在画布中可视化调度结果。

## 访问应用

开发服务器已启动：**http://localhost:8889/**

## 快速开始

### 方法1：使用随机生成（原有功能）

1. 访问 http://localhost:8889/
2. 点击"A*算法"
3. 切换到"多航班调度"标签
4. 确保选择"随机生成"选项卡
5. 选择航班数量（3-10架）
6. 点击"生成航班"
7. 点击"开始调度"查看结果

### 方法2：上传Excel文件（新功能）

#### 步骤1：准备Excel文件

创建一个Excel文件，第一行必须是以下列名（按顺序）：

```
flight_id | aircraft_type | operation | scheduled_time | start_node_id | end_node_id | priority
```

#### 步骤2：填写数据

| 列名 | 说明 | 示例 | 必填 |
|------|------|------|------|
| flight_id | 航班ID | FL1001, FL1002 | ✅ |
| aircraft_type | 机型 | A320, B737, A330 | ✅ |
| operation | 操作类型 | departure 或 arrival | ✅ |
| scheduled_time | 计划时间 | 2024-01-20 14:00:00 | ✅ |
| start_node_id | 起始节点ID | 1, 2, 3... | ✅ |
| end_node_id | 目标节点ID | 100, 200... | ✅ |
| priority | 优先级（1-10） | 5, 7, 3 | ✅ |

**示例数据：**

```
flight_id  aircraft_type  operation     scheduled_time         start_node_id  end_node_id  priority
FL1001     A320           departure     2024-01-20 14:00:00    1              100           5
FL1002     B737           arrival       2024-01-20 14:05:00    200            5             7
FL1003     A330           departure     2024-01-20 14:10:00    3              100           3
FL1004     B787           arrival       2024-01-20 14:15:00    201            8             6
FL1005     A350           departure     2024-01-20 14:20:00    2              100           8
```

#### 步骤3：上传文件

1. 在A*算法页面，切换到"多航班调度"标签
2. 点击"上传文件"选项卡
3. 点击"选择文件"按钮，选择你的Excel文件
4. 点击"提取航班信息"按钮
5. 如果数据格式正确，会显示"成功提取 X 条航班信息！"
6. 点击"开始调度"按钮
7. 在画布中查看调度结果

## 注意事项

1. **文件格式**：仅支持 .xlsx 和 .xls 格式
2. **列名**：必须使用英文列名，与上述表格完全一致（区分大小写）
3. **operation字段**：只能是 "departure"（离港）或 "arrival"（进港）
4. **时间格式**：必须是 "YYYY-MM-DD HH:MM:SS" 格式（24小时制）
5. **节点ID**：必须是数字（西安机场路网节点ID）
6. **优先级**：必须是1-10之间的数字

## 数据验证

系统会自动验证：
- ✅ 所有必填字段是否存在
- ✅ operation字段是否为有效值
- ✅ 时间格式是否正确
- ✅ 节点ID是否为数字
- ✅ 优先级是否在1-10范围内

如果数据有误，系统会显示详细的错误信息，包括错误行号和具体问题。

## 测试数据准备

### 使用WPS表格/Excel创建测试文件

1. 打开WPS表格或Excel
2. 在第一行输入列名：
   - A1: flight_id
   - B1: aircraft_type
   - C1: operation
   - D1: scheduled_time
   - E1: start_node_id
   - F1: end_node_id
   - G1: priority
3. 从第二行开始输入数据
4. 保存为 `test-flights.xlsx`

### 从CSV转换

项目根目录下有一个示例CSV文件：`example-flights.xlsx`

你可以直接打开这个文件查看示例数据，或者创建新的测试数据。

## 常见问题

### Q1: 提示"缺少字段"怎么办？
**A:** 检查Excel第一行的列名是否正确，确保拼写和大小写完全一致。

### Q2: 时间格式错误怎么办？
**A:** 确保时间格式为 `2024-01-20 14:00:00`，注意：
- 使用24小时制
- 日期和时间之间有空格
- 时分秒都是两位数

### Q3: 不知道应该填写哪些节点ID？
**A:** 你可以先使用"随机生成"功能，查看生成的航班数据使用的节点ID范围，然后参考这些ID来填写你的Excel文件。

### Q4: 提取失败显示错误？
**A:** 系统会显示具体的错误行和原因，例如：
- "第3行: 缺少字段 aircraft_type"
- "第5行: operation必须是'departure'或'arrival'"
- "第7行: 时间格式不正确"

根据错误提示修改Excel文件后重新上传即可。

### Q5: 最多可以上传多少条航班数据？
**A:** 建议不超过50条。虽然技术上没有硬性限制，但数据过多可能导致：
- 可视化效果不佳
- 性能下降
- 调度时间过长

## 功能对比

| 功能 | 随机生成 | 上传文件 |
|------|---------|---------|
| 数据来源 | 系统自动生成 | 用户自定义 |
| 灵活性 | 固定格式 | 完全自定义 |
| 适用场景 | 快速演示、测试 | 实际应用、特定数据 |
| 数据量 | 3-10架 | 不限（建议≤50架） |
| 节点控制 | 系统随机选择 | 用户精确控制 |

## 技术实现

- **文件解析**：使用 `xlsx` 库解析Excel文件
- **数据验证**：前端完整验证，确保数据质量
- **错误处理**：详细的错误提示，帮助快速定位问题
- **兼容性**：支持 .xlsx 和 .xls 两种格式

## 开发信息

- **依赖包**：xlsx (已安装)
- **组件**：AStarAlgorithm.vue
- **API端点**：/api/multi-aircraft/generate-simulation, /api/multi-aircraft/schedule

## 更新日志

### 2024-01-20
- ✅ 添加Excel文件上传功能
- ✅ 添加数据来源切换（随机生成/上传文件）
- ✅ 添加完整的数据验证
- ✅ 添加详细的错误提示
- ✅ 优化UI界面
- ✅ 创建使用文档

## 反馈与支持

如有问题或建议，请联系开发团队。
